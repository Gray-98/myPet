<script>
    import { onMount } from "svelte";
    import * as echarts from "echarts";

    let chart;

    // 数据和配置
    const option = {
      tooltip: {},
      animationDurationUpdate: 1000,
      animationEasingUpdate: "quinticInOut",
      series: [
        {
          type: "graph",
          layout: "none",
          roam: true,
          label: {
            show: true,
            position: "right",
          },
          edgeSymbol: ["none", "arrow"],
          edgeSymbolSize: 10,
          data: [
            { id: 0, name: "Root", x: 0, y: 0, symbolSize: 50 },
            { id: 1, name: "Node 1", x: 100, y: -100, symbolSize: 40 },
            { id: 2, name: "Node 2", x: 100, y: 100, symbolSize: 40 },
          ],
          links: [
            {
              source: 0,
              target: 1,
              lineStyle: { type: "dashed" },
              label: { show: true, formatter: "X" },
            },
            { source: 0, target: 2 },
          ],
          lineStyle: {
            width: 2,
            curveness: 0.3,
          },
        },
      ],
    };

    // 在组件挂载时初始化 ECharts
    onMount(() => {
      const container = document.getElementById("chart");
      chart = echarts.init(container);

      chart.setOption(option);

      // 添加周期性动画
      const animateRoot = () => {
        chart.setOption({
          series: [
            {
              data: [
                { id: 0, symbolSize: 60 }, // 放大根节点
                { id: 1, symbolSize: 40 },
                { id: 2, symbolSize: 40 },
              ],
            },
          ],
        });

        setTimeout(() => {
          chart.setOption({
            series: [
              {
                data: [
                  { id: 0, symbolSize: 50 }, // 恢复根节点大小
                  { id: 1, symbolSize: 40 },
                  { id: 2, symbolSize: 40 },
                ],
              },
            ],
          });
        }, 500);
      };

      const interval = setInterval(animateRoot, 2000);

      // 清理定时器
      return () => {
        clearInterval(interval);
        chart.dispose();
      };
    });
  </script>

  <style>
    #chart {
      width: 100%;
      height: 100vh;
    }
  </style>

  <div id="chart"></div>